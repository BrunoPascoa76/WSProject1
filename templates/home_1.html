{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
    <div id="background-container"></div>

    <div class="jumbotron text-center" id="foreground-content"> {# Foreground content #}
        <h1 class="display-4">Welcome to the Starwars Dataverse</h1>
        <p class="lead">May the force be with you</p>
        <hr class="my-2">
    </div>

    <div id="graph-container">
        {{ graph_html | safe }} {# Ensure this is rendered on top of the background #}
    </div>
{% endblock %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        var Colors = {
            roadColor: 0x999999,
            obstacleColor: 0xff0000,
            characterColor: 0x00ff00,
            ballColor: 0x8B4513
        };

        function World() {
            'use strict';
            var scene, camera, renderer, road, obstacles = [],
                powerUps = [];
            var container, aspectRatio,
                HEIGHT, WIDTH, fieldOfView,
                nearPlane, farPlane,
                mouseX, mouseY, windowHalfX,
                windowHalfY, geometry,
                starStuff, materialOptions, starField;
            var collectedPowerUps = 0;    

            this.speed = 10;

            init();

            function init() {
                container = document.createElement('div');
                document.getElementById('background-container').appendChild(container); // Append to background container
                document.body.style.overflow = 'hidden';

                HEIGHT = window.innerHeight;
                WIDTH = window.innerWidth;
                aspectRatio = WIDTH / HEIGHT;
                fieldOfView = 75;
                nearPlane = 1;
                farPlane = 1000;
                mouseX = 0;
                mouseY = 0;

                windowHalfX = WIDTH / 2;
                windowHalfY = HEIGHT / 2;

                // Camera setup
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
                camera.position.set(0, 500, -1000);
                camera.lookAt(0, 50, 0);

                scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x000000, 0.0003);

                // Ambient light
                var ambientLight = new THREE.AmbientLight(0xffffff, 10);
                scene.add(ambientLight);

                // Create stars
                createStars();

                // Renderer setup
                renderer = new THREE.WebGLRenderer({ alpha: true });
                renderer.setSize(WIDTH, HEIGHT);
                container.appendChild(renderer.domElement);  // Append the renderer to the container

                // Event listeners
                window.addEventListener('resize', onWindowResize, false);

                // Start animation loop
                loop();
            }

            function createStars() {
                var stars = new Array(0);
                for (var i = 0; i < 10000; i++) {
                    let x = THREE.Math.randFloatSpread(2000);
                    let y = THREE.Math.randFloatSpread(2000);
                    let z = THREE.Math.randFloatSpread(2000);
                    stars.push(x, y, z);
                }
                var starsGeometry = new THREE.BufferGeometry();
                starsGeometry.setAttribute("position", new THREE.Float32BufferAttribute(stars, 3));
                var starsMaterial = new THREE.PointsMaterial({ color: 0x888888 });
                starField = new THREE.Points(starsGeometry, starsMaterial);
                scene.add(starField);
            }

            function onWindowResize() {
                WIDTH = window.innerWidth;
                HEIGHT = window.innerHeight;

                camera.aspect = WIDTH / HEIGHT;
                camera.updateProjectionMatrix();
                renderer.setSize(WIDTH, HEIGHT);
            }

            function loop() {
                starField.rotation.x += 0.001;
                starField.rotation.y += 0.001;

                // Render the scene
                renderer.render(scene, camera);

                // Request the next frame
                requestAnimationFrame(loop);
            }

            loop();
        }

        // Create the world when the page is loaded
        window.onload = function() {
            var world = new World();
        };
    </script>

    <script>
        // Existing Network Click Handler
        network.on("click", function(params) {
            if (params.nodes.length > 0) {
                var nodeId = params.nodes[0];
                var node = network.body.data.nodes.get(nodeId);
                if (node && node.url) {
                    window.open(node.url, "_blank");
                }
            }
        });
    </script>
{% endblock %}

{% block styles %}
    <style>
        /* Set up the background container (Three.js canvas) */
        #background-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Ensure it stays in the background */
        }

        /* Ensure the foreground content stays above the canvas */
        #foreground-content {
            position: relative;
            z-index: 2; /* Higher z-index to stay on top of the background canvas */
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
        }

        /* Ensure graph container stays on top of everything */
        #graph-container {
            position: absolute;  /* Absolute positioning for overlay */
            top: 0;              /* Align to the top of the viewport */
            left: 0;             /* Align to the left of the viewport */
            width: 100%;         /* Fill the width of the screen */
            height: 100%;        /* Fill the height of the screen */
            z-index: 3;          /* Ensure it's above the background canvas */
            pointer-events: none; /* Allow clicks to pass through to underlying elements (optional) */
        }

        /* Ensure body takes up the full viewport */
        body {
            margin: 0;
            overflow: hidden;
            height: 100vh; /* Ensure the body fills the full viewport */
        }

    </style>
{% endblock %}


